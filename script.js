// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG (MOCK DATA) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG C·ª¶A B·∫†N (80 T·ª™) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 4) ---

// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 3) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 5) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 6) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 7) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 8) ---
// --- D·ªÆ LI·ªÜU T·ª™ V·ª∞NG M·ªöI (80 T·ª™ - ƒê·ª£t 9) ---
const vocabularyData = [
  {
    id: 1,
    word: "ladder",
    ipa: "/Ààl√¶d.…ôr/",
    meaning: "c√°i thang",
    example: "He climbed the ladder to paint the ceiling.",
  },
  {
    id: 2,
    word: "rack",
    ipa: "/r√¶k/",
    meaning: "gi√° ƒë·ª°, m√≥c treo",
    example: "Please hang your coat on the rack.",
  },
  {
    id: 3,
    word: "light fixture",
    ipa: "/la…™t Ààf…™ks.t É…ôr/",
    meaning: "thi·∫øt b·ªã chi·∫øu s√°ng, ƒë√®n ch√πm",
    example: "We need to replace the old light fixture.",
  },
  {
    id: 4,
    word: "merchandise",
    ipa: "/Ààm…úÀê.t É…ôn.da…™z/",
    meaning: "h√†ng h√≥a",
    example: "They display the merchandise in the window.",
  },
  {
    id: 5,
    word: "trim",
    ipa: "/tr…™m/",
    meaning: "c·∫Øt, t·ªâa",
    example: "He needs to trim the hedge.",
  },
  {
    id: 6,
    word: "hang",
    ipa: "/h√¶≈ã/",
    meaning: "treo",
    example: "Hang your picture on the wall.",
  },
  {
    id: 7,
    word: "cover",
    ipa: "/Ààk åv.…ôr/",
    meaning: "che ph·ªß, bao b·ªçc",
    example: "Snow covered the ground.",
  },
  {
    id: 8,
    word: "assistant",
    ipa: "/…ôÀàs…™s.t…ônt/",
    meaning: "tr·ª£ l√Ω",
    example: "My assistant will schedule the meeting.",
  },
  {
    id: 9,
    word: "regulation",
    ipa: "/Àåre…°.j…ôÀàle…™. É…ôn/",
    meaning: "quy ƒë·ªãnh",
    example: "We must follow safety regulations.",
  },
  {
    id: 10,
    word: "round-trip",
    ipa: "/Àåra änd Ààtr…™p/",
    meaning: "chuy·∫øn ƒëi kh·ª© h·ªìi",
    example: "I bought a round-trip ticket to London.",
  },
  {
    id: 11,
    word: "merger",
    ipa: "/Ààm…úÀê.d í…ôr/",
    meaning: "s·ª± s√°p nh·∫≠p",
    example: "The merger of the two companies was successful.",
  },
  {
    id: 12,
    word: "security",
    ipa: "/s…™Ààkj ä…ô.r…ô.ti/",
    meaning: "an ninh",
    example: "Airport security is very strict.",
  },
  {
    id: 13,
    word: "distribute",
    ipa: "/d…™Ààstr…™b.juÀêt/",
    meaning: "ph√¢n ph·ªëi",
    example: "Volunteers distributed food to the homeless.",
  },
  {
    id: 14,
    word: "flyer",
    ipa: "/Ààfla…™.…ôr/",
    meaning: "t·ªù r∆°i",
    example: "She handed out flyers for the concert.",
  },
  {
    id: 15,
    word: "professional",
    ipa: "/pr…ôÀàfe É.…ôn.…ôl/",
    meaning: "chuy√™n nghi·ªáp",
    example: "He is a very professional employee.",
  },
  {
    id: 16,
    word: "official",
    ipa: "/…ôÀàf…™ É.…ôl/",
    meaning: "ch√≠nh th·ª©c",
    example: "The official announcement will be made tomorrow.",
  },
  {
    id: 17,
    word: "organize",
    ipa: "/Àà…îÀê.…°…ôn.a…™z/",
    meaning: "t·ªï ch·ª©c, s·∫Øp x·∫øp",
    example: "She helped organize the event.",
  },
  {
    id: 18,
    word: "role",
    ipa: "/r…ô äl/",
    meaning: "vai tr√≤",
    example: "Technology plays a key role in our lives.",
  },
  {
    id: 19,
    word: "responsible",
    ipa: "/r…™Ààsp…ín.s…ô.b…ôl/",
    meaning: "c√≥ tr√°ch nhi·ªám",
    example: "Who is responsible for this mess?",
  },
  {
    id: 20,
    word: "various",
    ipa: "/Ààve…ô.ri.…ôs/",
    meaning: "ƒëa d·∫°ng, kh√°c nhau",
    example: "The store sells various types of cheese.",
  },
  {
    id: 21,
    word: "previous",
    ipa: "/ÀàpriÀê.vi.…ôs/",
    meaning: "tr∆∞·ªõc ƒë√≥",
    example: "In the previous chapter, we learned about verbs.",
  },
  {
    id: 22,
    word: "emphasize",
    ipa: "/Ààem.f…ô.sa…™z/",
    meaning: "nh·∫•n m·∫°nh",
    example: "The teacher emphasized the importance of homework.",
  },
  {
    id: 23,
    word: "appreciate",
    ipa: "/…ôÀàpriÀê. Éi.e…™t/",
    meaning: "tr√¢n tr·ªçng, ƒë√°nh gi√° cao",
    example: "I really appreciate your help.",
  },
  {
    id: 24,
    word: "grocery",
    ipa: "/Àà…°r…ô ä.s…ôr.i/",
    meaning: "h√†ng t·∫°p h√≥a",
    example: "I need to go to the grocery store.",
  },
  {
    id: 25,
    word: "demonstration",
    ipa: "/Àådem.…ônÀàstre…™. É…ôn/",
    meaning: "s·ª± minh ho·∫°, gi·ªõi thi·ªáu s·∫£n ph·∫©m",
    example: "We watched a demonstration of the new software.",
  },
  {
    id: 26,
    word: "decision",
    ipa: "/d…™Ààs…™ í.…ôn/",
    meaning: "quy·∫øt ƒë·ªãnh",
    example: "It was a difficult decision to make.",
  },
  {
    id: 27,
    word: "feature",
    ipa: "/ÀàfiÀê.t É…ôr/",
    meaning: "ƒë·∫∑c ƒëi·ªÉm / t√≠nh nƒÉng",
    example: "This phone has many new features.",
  },
  {
    id: 28,
    word: "capacity",
    ipa: "/k…ôÀàp√¶s.…ô.ti/",
    meaning: "s·ª©c ch·ª©a, c√¥ng su·∫•t",
    example: "The stadium has a capacity of 50,000.",
  },
  {
    id: 29,
    word: "significantly",
    ipa: "/s…™…°Ààn…™f.…™.k…ônt.li/",
    meaning: "m·ªôt c√°ch ƒë√°ng k·ªÉ",
    example: "Sales have increased significantly.",
  },
  {
    id: 30,
    word: "revise",
    ipa: "/r…™Ààva…™z/",
    meaning: "s·ª≠a ƒë·ªïi, √¥n t·∫≠p",
    example: "Please revise your essay.",
  },
  {
    id: 31,
    word: "inspection",
    ipa: "/…™nÀàspek. É…ôn/",
    meaning: "s·ª± ki·ªÉm tra, thanh tra",
    example: "The building passed the safety inspection.",
  },
  {
    id: 32,
    word: "direction",
    ipa: "/da…™Ààrek. É…ôn/",
    meaning: "h∆∞·ªõng, s·ª± ch·ªâ d·∫´n",
    example: "Which direction should we go?",
  },
  {
    id: 33,
    word: "existing",
    ipa: "/…™…°Ààz…™s.t…™≈ã/",
    meaning: "hi·ªán c√≥",
    example: "We need to improve the existing system.",
  },
  {
    id: 34,
    word: "strategy",
    ipa: "/Ààstr√¶t.…ô.d íi/",
    meaning: "chi·∫øn l∆∞·ª£c",
    example: "We need a new marketing strategy.",
  },
  {
    id: 35,
    word: "bid",
    ipa: "/b…™d/",
    meaning: "s·ª± b·ªè th·∫ßu / ƒë·∫•u th·∫ßu",
    example: "They won the bid for the project.",
  },
  {
    id: 36,
    word: "seek",
    ipa: "/siÀêk/",
    meaning: "t√¨m ki·∫øm",
    example: "He is going to seek legal advice.",
  },
  {
    id: 37,
    word: "additional",
    ipa: "/…ôÀàd…™ É.…ôn.…ôl/",
    meaning: "b·ªï sung, th√™m",
    example: "There is an additional charge for delivery.",
  },
  {
    id: 38,
    word: "compare",
    ipa: "/k…ômÀàpe…ôr/",
    meaning: "so s√°nh",
    example: "Compare the prices before you buy.",
  },
  {
    id: 39,
    word: "reference",
    ipa: "/Ààref.…ôr.…ôns/",
    meaning: "s·ª± tham kh·∫£o, th∆∞ gi·ªõi thi·ªáu",
    example: "Keep this book for future reference.",
  },
  {
    id: 40,
    word: "method",
    ipa: "/ÀàmeŒ∏.…ôd/",
    meaning: "ph∆∞∆°ng ph√°p",
    example: "This is a new method of teaching.",
  },
  {
    id: 41,
    word: "temporarily",
    ipa: "/Ààtem.pr…ôr.…ôl.i/",
    meaning: "m·ªôt c√°ch t·∫°m th·ªùi",
    example: "The shop is temporarily closed.",
  },
  {
    id: 42,
    word: "ensure",
    ipa: "/…™nÀà É…îÀêr/",
    meaning: "ƒë·∫£m b·∫£o",
    example: "Please ensure that the door is locked.",
  },
  {
    id: 43,
    word: "income",
    ipa: "/Àà…™≈ã.k åm/",
    meaning: "thu nh·∫≠p",
    example: "He has a high annual income.",
  },
  {
    id: 44,
    word: "layout",
    ipa: "/Ààle…™.a ät/",
    meaning: "b·ªë c·ª•c, c√°ch b·ªë tr√≠",
    example: "I like the layout of the apartment.",
  },
  {
    id: 45,
    word: "wheelbarrow",
    ipa: "/ÀàwiÀêlÀåb√¶r.…ô ä/",
    meaning: "xe r√πa, xe c√∫t k√≠t",
    example: "He used a wheelbarrow to move the bricks.",
  },
  {
    id: 46,
    word: "misplace",
    ipa: "/Àåm…™sÀàple…™s/",
    meaning: "ƒë·ªÉ qu√™n, ƒë·ªÉ sai ch·ªó",
    example: "I misplaced my keys again.",
  },
  {
    id: 47,
    word: "priority",
    ipa: "/pra…™Àà…ír.…ô.ti/",
    meaning: "s·ª± ∆∞u ti√™n",
    example: "Safety is our top priority.",
  },
  {
    id: 48,
    word: "initial",
    ipa: "/…™Ààn…™ É.…ôl/",
    meaning: "ban ƒë·∫ßu",
    example: "My initial reaction was surprise.",
  },
  {
    id: 49,
    word: "in person",
    ipa: "/…™n Ààp…úÀê.s…ôn/",
    meaning: "tr·ª±c ti·∫øp, ƒë√≠ch th√¢n",
    example: "You must apply for the visa in person.",
  },
  {
    id: 50,
    word: "reward",
    ipa: "/r…™Ààw…îÀêd/",
    meaning: "ph·∫ßn th∆∞·ªüng",
    example: "He received a reward for his hard work.",
  },
  {
    id: 51,
    word: "wrap up",
    ipa: "/r√¶p  åp/",
    meaning: "g√≥i l·∫°i, k·∫øt th√∫c",
    example: "Let's wrap up the meeting.",
  },
  {
    id: 52,
    word: "complain",
    ipa: "/k…ômÀàple…™n/",
    meaning: "ph√†n n√†n",
    example: "He is always complaining about the weather.",
  },
  {
    id: 53,
    word: "fill out",
    ipa: "/f…™l a ät/",
    meaning: "ƒëi·ªÅn v√†o (ƒë∆°n)",
    example: "Please fill out this application form.",
  },
  {
    id: 54,
    word: "enthusiasm",
    ipa: "/…™nÀàŒ∏juÀê.zi.√¶z.…ôm/",
    meaning: "s·ª± nhi·ªát huy·∫øt",
    example: "She showed great enthusiasm for the project.",
  },
  {
    id: 55,
    word: "interruption",
    ipa: "/Àå…™n.t…ôÀàr åp. É…ôn/",
    meaning: "s·ª± gi√°n ƒëo·∫°n",
    example: "I worked all day without interruption.",
  },
  {
    id: 56,
    word: "connection",
    ipa: "/k…ôÀànek. É…ôn/",
    meaning: "s·ª± k·∫øt n·ªëi",
    example: "My internet connection is slow.",
  },
  {
    id: 57,
    word: "take over",
    ipa: "/te…™k Àà…ô ä.v…ôr/",
    meaning: "ƒë·∫£m nh·∫≠n, ti·∫øp qu·∫£n",
    example: "He will take over the business next year.",
  },
  {
    id: 58,
    word: "entire",
    ipa: "/…™nÀàta…™…ôr/",
    meaning: "to√†n b·ªô",
    example: "I spent the entire day cleaning.",
  },
  {
    id: 59,
    word: "retire",
    ipa: "/r…™Ààta…™…ôr/",
    meaning: "ngh·ªâ h∆∞u",
    example: "He plans to retire at age 65.",
  },
  {
    id: 60,
    word: "incentive",
    ipa: "/…™nÀàsen.t…™v/",
    meaning: "s·ª± kh√≠ch l·ªá, ƒë·ªông c∆° th√∫c ƒë·∫©y",
    example: "Bonus payments act as an incentive.",
  },
  {
    id: 61,
    word: "value",
    ipa: "/Ààv√¶l.juÀê/",
    meaning: "gi√° tr·ªã",
    example: "This car has great value.",
  },
  {
    id: 62,
    word: "transportation",
    ipa: "/Àåtr√¶n.sp…îÀêÀàte…™. É…ôn/",
    meaning: "giao th√¥ng, v·∫≠n t·∫£i",
    example: "Public transportation is cheap here.",
  },
  {
    id: 63,
    word: "promote",
    ipa: "/pr…ôÀàm…ô ät/",
    meaning: "qu·∫£ng b√° / thƒÉng ch·ª©c",
    example: "He was promoted to manager.",
  },
  {
    id: 64,
    word: "reduce",
    ipa: "/r…™Ààd íuÀês/",
    meaning: "gi·∫£m",
    example: "We need to reduce costs.",
  },
  {
    id: 65,
    word: "assembly",
    ipa: "/…ôÀàsem.bli/",
    meaning: "s·ª± l·∫Øp r√°p",
    example: "The assembly line moves quickly.",
  },
  {
    id: 66,
    word: "standard",
    ipa: "/Ààst√¶n.d…ôd/",
    meaning: "ti√™u chu·∫©n",
    example: "We set high standards for quality.",
  },
  {
    id: 67,
    word: "immediately",
    ipa: "/…™ÀàmiÀê.di.…ôt.li/",
    meaning: "ngay l·∫≠p t·ª©c",
    example: "Call an ambulance immediately.",
  },
  {
    id: 68,
    word: "allow",
    ipa: "/…ôÀàla ä/",
    meaning: "cho ph√©p",
    example: "Smoking is not allowed here.",
  },
  {
    id: 69,
    word: "belongings",
    ipa: "/b…™Ààl…í≈ã.…™≈ãz/",
    meaning: "t∆∞ trang, ƒë·ªì d√πng c√° nh√¢n",
    example: "Please take all your belongings with you.",
  },
  {
    id: 70,
    word: "designated",
    ipa: "/Ààdez.…™…°.ne…™t…™d/",
    meaning: "ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh",
    example: "Park only in designated areas.",
  },
  {
    id: 71,
    word: "on-site",
    ipa: "/Àå…ínÀàsa…™t/",
    meaning: "t·∫°i ch·ªó, t·∫°i hi·ªán tr∆∞·ªùng",
    example: "There is an on-site gym for employees.",
  },
  {
    id: 72,
    word: "financial",
    ipa: "/fa…™Ààn√¶n. É…ôl/",
    meaning: "thu·ªôc t√†i ch√≠nh",
    example: "They are having financial difficulties.",
  },
  {
    id: 73,
    word: "mandatory",
    ipa: "/Ààm√¶n.d…ô.t…ôr.i/",
    meaning: "b·∫Øt bu·ªôc",
    example: "Wearing a helmet is mandatory.",
  },
  {
    id: 74,
    word: "paycheck",
    ipa: "/Ààpe…™.t Éek/",
    meaning: "ti·ªÅn l∆∞∆°ng, s√©c l∆∞∆°ng",
    example: "I receive my paycheck every Friday.",
  },
  {
    id: 75,
    word: "accept",
    ipa: "/…ôkÀàsept/",
    meaning: "ch·∫•p nh·∫≠n",
    example: "Do you accept credit cards?",
  },
  {
    id: 76,
    word: "ingredient",
    ipa: "/…™nÀà…°riÀê.di.…ônt/",
    meaning: "nguy√™n li·ªáu (n·∫•u ƒÉn)",
    example: "Mix all the ingredients in a bowl.",
  },
  {
    id: 77,
    word: "currently",
    ipa: "/Ààk år.…ônt.li/",
    meaning: "hi·ªán t·∫°i",
    example: "He is currently working on a new book.",
  },
  {
    id: 78,
    word: "approach",
    ipa: "/…ôÀàpr…ô ät É/",
    meaning: "ti·∫øp c·∫≠n, ph∆∞∆°ng ph√°p",
    example: "We need a new approach to the problem.",
  },
  {
    id: 79,
    word: "affect",
    ipa: "/…ôÀàfekt/",
    meaning: "·∫£nh h∆∞·ªüng, t√°c ƒë·ªông",
    example: "The weather affects my mood.",
  },
  {
    id: 80,
    word: "congestion",
    ipa: "/k…ônÀàd íes.t É…ôn/",
    meaning: "s·ª± t·∫Øc ngh·∫Ωn (giao th√¥ng)",
    example: "Traffic congestion is bad in the city center.",
  },
];
// ... (Ph·∫ßn danh s√°ch vocabularyData ·ªü tr√™n gi·ªØ nguy√™n) ...

// --- BI·∫æN TO√ÄN C·ª§C ---
let currentList = [...vocabularyData]; // T·∫°o b·∫£n sao ƒë·ªÉ thao t√°c (h·ªó tr·ª£ shuffle)
let currentIndex = 0;
let learnedWords = JSON.parse(localStorage.getItem("learnedWords")) || [];

// --- DOM ELEMENTS ---
const navItems = document.querySelectorAll("nav ul li");
const sections = document.querySelectorAll(".section");

// Flashcard Elements
const card = document.getElementById("flashcard");
const wordEl = document.getElementById("vocab-word");
const ipaEl = document.getElementById("vocab-ipa");
const meaningEl = document.getElementById("vocab-meaning");
const exampleEl = document.getElementById("vocab-example");
const countEl = document.getElementById("card-counter");
const btnNext = document.getElementById("btn-next");
const btnPrev = document.getElementById("btn-prev");
const btnSpeak = document.getElementById("btn-speak");
const btnMarkLearned = document.getElementById("btn-mark-learned");

// New Controls Elements
const jumpInput = document.getElementById("jump-input");
const btnJump = document.getElementById("btn-jump");
const btnShuffle = document.getElementById("btn-shuffle");

// Quiz Elements
const quizWord = document.getElementById("quiz-word");
const quizOptions = document.getElementById("quiz-options");
const quizFeedback = document.getElementById("quiz-feedback");
const btnNextQuiz = document.getElementById("btn-next-quiz");

// Progress Elements
const learnedCountEl = document.getElementById("learned-count");
const totalCountEl = document.getElementById("total-count");
const progressPercentEl = document.getElementById("progress-percent");
const btnReset = document.getElementById("btn-reset");

// --- H√ÄM KH·ªûI T·∫†O ---
function init() {
  setupNavigation();
  renderCard(currentIndex);
  updateProgressUI();
  loadQuiz();

  // ƒê·∫∑t gi·ªõi h·∫°n max cho √¥ input jump
  jumpInput.max = currentList.length;
}

// --- 1. LOGIC FLASHCARD (ƒê√£ c·∫≠p nh·∫≠t ƒë·ªÉ d√πng currentList) ---

function renderCard(index) {
  const data = currentList[index]; // L·∫•y d·ªØ li·ªáu t·ª´ danh s√°ch hi·ªán t·∫°i (ƒë√£/ch∆∞a shuffle)

  card.classList.remove("flipped");

  setTimeout(() => {
    wordEl.textContent = data.word;
    ipaEl.textContent = data.ipa;
    meaningEl.textContent = data.meaning;
    exampleEl.textContent = `"${data.example}"`;
    // Hi·ªÉn th·ªã s·ªë trang: Index + 1 / T·ªïng s·ªë
    countEl.textContent = `${index + 1} / ${currentList.length}`;

    // C·∫≠p nh·∫≠t gi√° tr·ªã √¥ input ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt ƒëang ·ªü ƒë√¢u
    jumpInput.value = index + 1;

    // Ki·ªÉm tra tr·∫°ng th√°i ƒë√£ h·ªçc (d·ª±a tr√™n ID g·ªëc c·ªßa t·ª´)
    if (learnedWords.includes(data.id)) {
      btnMarkLearned.textContent = "‚úÖ ƒê√£ thu·ªôc (ƒê√£ l∆∞u)";
      btnMarkLearned.disabled = true;
      btnMarkLearned.style.opacity = "0.6";
    } else {
      btnMarkLearned.textContent = "‚úÖ ƒê√°nh d·∫•u ƒë√£ thu·ªôc";
      btnMarkLearned.disabled = false;
      btnMarkLearned.style.opacity = "1";
    }
  }, 200);
}

// L·∫≠t th·∫ª
card.addEventListener("click", () => card.classList.toggle("flipped"));

// Next / Prev
btnNext.addEventListener("click", (e) => {
  e.stopPropagation();
  if (currentIndex < currentList.length - 1) {
    currentIndex++;
    renderCard(currentIndex);
  }
});

btnPrev.addEventListener("click", (e) => {
  e.stopPropagation();
  if (currentIndex > 0) {
    currentIndex--;
    renderCard(currentIndex);
  }
});

// Text to Speech
btnSpeak.addEventListener("click", (e) => {
  e.stopPropagation();
  const utterance = new SpeechSynthesisUtterance(
    currentList[currentIndex].word
  );
  utterance.lang = "en-US";
  utterance.rate = 0.8;
  window.speechSynthesis.speak(utterance);
});

// ƒê√°nh d·∫•u ƒë√£ h·ªçc
btnMarkLearned.addEventListener("click", (e) => {
  e.stopPropagation();
  const currentId = currentList[currentIndex].id;
  if (!learnedWords.includes(currentId)) {
    learnedWords.push(currentId);
    saveProgress();
    renderCard(currentIndex);
    updateProgressUI();
  }
});

// --- T√çNH NƒÇNG M·ªöI: JUMP & SHUFFLE ---

// 1. Ch·ª©c nƒÉng Nh·∫£y ƒë·∫øn trang (Jump)
btnJump.addEventListener("click", () => {
  const pageNumber = parseInt(jumpInput.value);

  if (pageNumber >= 1 && pageNumber <= currentList.length) {
    currentIndex = pageNumber - 1; // V√¨ m·∫£ng b·∫Øt ƒë·∫ßu t·ª´ 0
    renderCard(currentIndex);
  } else {
    alert(`Vui l√≤ng nh·∫≠p s·ªë t·ª´ 1 ƒë·∫øn ${currentList.length}`);
  }
});

// Cho ph√©p ·∫•n Enter trong √¥ input
jumpInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") btnJump.click();
});

// 2. Ch·ª©c nƒÉng X√°o tr·ªôn (Shuffle)
btnShuffle.addEventListener("click", () => {
  // Thu·∫≠t to√°n Fisher-Yates Shuffle
  for (let i = currentList.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [currentList[i], currentList[j]] = [currentList[j], currentList[i]];
  }

  // Reset v·ªÅ th·∫ª ƒë·∫ßu ti√™n sau khi tr·ªôn
  currentIndex = 0;
  renderCard(currentIndex);

  // Hi·ªáu ·ª©ng th√¥ng b√°o nh·ªè
  const originalText = btnShuffle.innerText;
  btnShuffle.innerText = "ƒê√£ tr·ªôn xong!";
  setTimeout(() => {
    btnShuffle.innerText = originalText;
  }, 1500);
});

// --- C√ÅC PH·∫¶N C√íN L·∫†I (GI·ªÆ NGUY√äN) ---

function setupNavigation() {
  navItems.forEach((item) => {
    item.addEventListener("click", () => {
      navItems.forEach((nav) => nav.classList.remove("active"));
      item.classList.add("active");
      const targetId = item.getAttribute("data-target");
      sections.forEach((sec) => sec.classList.remove("active-section"));
      document.getElementById(targetId).classList.add("active-section");
    });
  });
}
window.navigateTo = (targetId) =>
  document.querySelector(`nav ul li[data-target="${targetId}"]`).click();

// Quiz Logic
function loadQuiz() {
  quizFeedback.textContent = "";
  quizOptions.innerHTML = "";
  btnNextQuiz.style.display = "none";

  // V·∫´n d√πng vocabularyData g·ªëc cho quiz ƒë·ªÉ ƒë·∫£m b·∫£o ng·∫´u nhi√™n ƒë·ªôc l·∫≠p v·ªõi flashcard
  const correctData =
    vocabularyData[Math.floor(Math.random() * vocabularyData.length)];
  quizWord.textContent = correctData.word;

  let options = [correctData];
  while (options.length < 4) {
    const randomItem =
      vocabularyData[Math.floor(Math.random() * vocabularyData.length)];
    if (!options.includes(randomItem)) options.push(randomItem);
  }
  options.sort(() => Math.random() - 0.5);

  options.forEach((opt) => {
    const btn = document.createElement("button");
    btn.classList.add("option-btn");
    btn.textContent = opt.meaning;
    btn.onclick = () => checkAnswer(opt.id, correctData.id, btn);
    quizOptions.appendChild(btn);
  });
}

function checkAnswer(selectedId, correctId, btnElement) {
  const allBtns = document.querySelectorAll(".option-btn");
  allBtns.forEach((b) => (b.disabled = true));
  if (selectedId === correctId) {
    btnElement.classList.add("correct");
    quizFeedback.textContent = "Ch√≠nh x√°c! üéâ";
    quizFeedback.style.color = "var(--success)";
  } else {
    btnElement.classList.add("wrong");
    quizFeedback.textContent = "Sai r·ªìi! üòÖ";
    quizFeedback.style.color = "var(--error)";
    allBtns.forEach((b) => {
      if (
        b.textContent === vocabularyData.find((v) => v.id === correctId).meaning
      )
        b.classList.add("correct");
    });
  }
  btnNextQuiz.style.display = "inline-block";
}
btnNextQuiz.addEventListener("click", loadQuiz);

// Progress Logic
function saveProgress() {
  localStorage.setItem("learnedWords", JSON.stringify(learnedWords));
}
function updateProgressUI() {
  const total = vocabularyData.length;
  const learned = learnedWords.length;
  const percent = Math.round((learned / total) * 100);
  learnedCountEl.textContent = learned;
  totalCountEl.textContent = total;
  progressPercentEl.textContent = `${percent}%`;
  progressPercentEl.style.color =
    percent === 100 ? "var(--success)" : "var(--primary)";
}
btnReset.addEventListener("click", () => {
  if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô ti·∫øn ƒë·ªô h·ªçc kh√¥ng?")) {
    learnedWords = [];
    saveProgress();
    updateProgressUI();
    renderCard(currentIndex);
  }
});

// Ch·∫°y ·ª©ng d·ª•ng
document.addEventListener("DOMContentLoaded", init);
